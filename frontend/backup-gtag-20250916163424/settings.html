<!DOCTYPE html>
<html lang="en">
  <head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JY9E760ZQ0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);} 
  gtag('js', new Date());

  gtag('config', 'G-JY9E760ZQ0');
</script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Settings - InRent</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./css/main.css" />
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-1F24YHYS28"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-1F24YHYS28");
    </script>
    <style>
      :root {
        --forest-green: #228b22;
        --black: #000000;
        --white: #ffffff;
        --light-green: #e8f5e9;
        --dark-green: #176b16;
        --accent-green: #b2ffb2;
        --dark: whitesmoke;
      }
      body {
        font-family: "Poppins", sans-serif;
        background-color: var(--dark);
        color: var(--black);
        margin: 0;
        padding: 0;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1rem;
      }
      header {
        background-color: var(--white);
        padding: 1rem 0;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        z-index: 1000;
      }
      header nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      .logo {
        font-size: 1.5rem;
        font-weight: 700;
      }
      .logo .in {
        color: var(--forest-green);
      }
      .logo .rent {
        color: var(--black);
      }
      .nav-links {
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
        gap: 2rem;
      }
      .nav-links li a {
        text-decoration: none;
        color: var(--black);
        font-weight: 500;
        transition: color 0.2s;
      }
      .nav-links li a:hover {
        color: var(--forest-green);
      }
      .btn {
        padding: 0.6rem 1.2rem;
        border-radius: 7px;
        font-weight: 600;
        text-decoration: none;
        transition: background-color 0.2s, color 0.2s;
        border: 1.5px solid transparent;
        cursor: pointer;
      }
      .btn-primary {
        background-color: var(--forest-green);
        color: var(--white);
        border-color: var(--forest-green);
      }
      .btn-primary:hover {
        background-color: var(--dark-green);
      }
      .btn-outline {
        background-color: var(--white);
        color: var(--forest-green);
        border-color: var(--forest-green);
      }
      .btn-outline:hover {
        background-color: var(--light-green);
        color: var(--dark-green);
      }
      #logoutBtn {
        background-color: var(--white);
        color: var(--forest-green);
        border: 1.5px solid var(--forest-green);
      }
      #logoutBtn:hover {
        background-color: var(--light-green);
      }
      main {
        margin-top: 90px;
        min-height: 80vh;
      }
      .settings-container {
        max-width: 500px;
        margin: 2.5rem auto 0;
        background-color: var(--white);
        border-radius: 18px;
        box-shadow: 0 4px 24px rgba(34, 139, 34, 0.08);
        padding: 2.5rem 2rem;
      }
      .settings-header {
        text-align: center;
        margin-bottom: 2rem;
      }
      .settings-title {
        font-size: 2rem;
        color: var(--forest-green);
        font-weight: 700;
        margin: 0;
      }
      .settings-subtitle {
        color: #666;
        font-size: 1.1rem;
        margin-top: 0.5rem;
      }
      .settings-form {
        display: flex;
        flex-direction: column;
        gap: 1.3rem;
      }
      .form-group {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }
      label {
        font-weight: 600;
        color: var(--forest-green);
      }
      input[type="email"],
      input[type="password"] {
        width: 100%;
        padding: 0.7rem 1rem;
        border: 1.5px solid var(--forest-green);
        border-radius: 7px;
        font-size: 1rem;
        color: var(--black);
        background-color: var(--light-green);
      }
      input[type="email"]:focus,
      input[type="password"]:focus {
        outline: none;
        border-color: var(--dark-green);
        box-shadow: 0 0 0 3px var(--accent-green);
      }
      .profile-photo-preview {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid var(--forest-green);
      }
      #uploadPhotoBtn {
        background-color: var(--forest-green);
        color: var(--white);
        border: none;
      }
      #uploadPhotoBtn:hover {
        background-color: var(--dark-green);
      }
      .success-message {
        color: var(--forest-green);
        font-weight: 500;
        margin-top: 0.7rem;
        font-size: 1rem;
      }
      footer {
        background-color: var(--white);
        color: var(--forest-green);
        text-align: center;
        padding: 2rem 0;
        margin-top: 2.5rem;
      }
      footer p {
        font-size: 1.1rem;
        margin: 0;
      }
      @media (max-width: 900px) {
        .nav-links {
          display: none;
        }
        header nav {
          padding: 0 1rem;
        }
      }
      @media (max-width: 600px) {
        .settings-container {
          max-width: 100%;
          border-radius: 0;
          box-shadow: none;
          padding: 1.5rem 1rem;
        }
        main {
          margin-top: 70px;
        }
        .settings-title {
          font-size: 1.5rem;
        }
        .settings-subtitle {
          font-size: 1rem;
        }
        label,
        input,
        button {
          font-size: 0.9rem;
        }
      }
    </style>
  </head>
  <body>
    <header>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JY9E760ZQ0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);} 
  gtag('js', new Date());

  gtag('config', 'G-JY9E760ZQ0');
</script>
      <div class="container">
        <nav>
          <div class="logo">
            <span class="in">In</span><span class="rent">Rent</span>
          </div>
          <ul class="nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="marketplace.html"> Accommodations</a></li>
            
          </ul>
          <button id="logoutBtn" class="btn btn-outline">
            <i class="fas fa-sign-out-alt"></i> Logout
          </button>
        </nav>
      </div>
    </header>
    <main>
      <div class="settings-container">
        <div class="settings-header">
          <h1 class="settings-title">Account Settings</h1>
          <p class="settings-subtitle">Manage your account preferences</p>
        </div>
        <form
          id="settingsForm"
          class="settings-form"
          enctype="multipart/form-data"
        >
          <div class="form-group">
            <label for="profilePhoto">Change Profile Photo</label>
            <input
              type="file"
              id="profilePhoto"
              accept="image/*"
              style="margin-bottom: 0.5rem"
            />
            <img
              id="profilePhotoPreview"
              src=""
              alt="Profile Preview"
              class="profile-photo-preview"
              style="display: none"
            />
            <button type="button" id="uploadPhotoBtn" class="btn btn-primary">
              Upload Photo
            </button>
            <div id="photoUploadMsg" class="success-message"></div>
          </div>
          <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" required />
          </div>
          <div class="form-group">
            <label for="currentPassword">Current Password</label>
            <input type="password" id="currentPassword" required />
          </div>
          <div class="form-group">
            <label for="password">New Password</label>
            <input type="password" id="password" />
          </div>
          <button type="submit" class="btn btn-primary">
            Update Settings
          </button>
          <div id="settingsFormSuccess" class="success-message"></div>
        </form>
      </div>
    </main>
    <footer>
      <div class="container">
        <p>&copy; 2025 InRent. All rights reserved.</p>
      </div>
    </footer>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const logoutBtn = document.getElementById("logoutBtn");
        if (logoutBtn) {
          logoutBtn.addEventListener("click", async function () {
            try {
              await fetch("/api/auth/logout", {
                method: "POST",
                credentials: "include",
              });
            } catch (e) {}
            window.location.href = "index.html";
          });
        }
      });
      const profilePhotoInput = document.getElementById("profilePhoto");
      const profilePhotoPreview = document.getElementById(
        "profilePhotoPreview"
      );
      const uploadPhotoBtn = document.getElementById("uploadPhotoBtn");
      const photoUploadMsg = document.getElementById("photoUploadMsg");
      if (profilePhotoInput) {
        profilePhotoInput.addEventListener("change", function () {
          const file = this.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
              profilePhotoPreview.src = e.target.result;
              profilePhotoPreview.style.display = "block";
            };
            reader.readAsDataURL(file);
          } else {
            profilePhotoPreview.style.display = "none";
          }
        });
      }
      if (uploadPhotoBtn) {
        uploadPhotoBtn.addEventListener("click", async function () {
          const file = profilePhotoInput.files[0];
          if (!file) {
            photoUploadMsg.textContent = "Please select a photo.";
            return;
          }
          const formData = new FormData();
          formData.append("profilePhoto", file);
          try {
            const res = await fetch("/api/user/profile-photo", {
              method: "POST",
              credentials: "include",
              body: formData,
            });
            if (res.ok) {
              photoUploadMsg.textContent = "Profile photo updated!";
              setTimeout(() => {
                photoUploadMsg.textContent = "";
              }, 2000);
            } else {
              photoUploadMsg.textContent = "Failed to update photo.";
            }
          } catch (e) {
            photoUploadMsg.textContent = "Error uploading photo.";
          }
        });
      }
      const settingsForm = document.getElementById("settingsForm");
      const settingsFormSuccess = document.getElementById(
        "settingsFormSuccess"
      );
      settingsForm.addEventListener("submit", async function (e) {
        e.preventDefault();
        const email = document.getElementById("email").value;
        const currentPassword =
          document.getElementById("currentPassword").value;
        const newPassword = document.getElementById("password").value;
        try {
          const res = await fetch("/api/user/settings", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            credentials: "include",
            body: JSON.stringify({ email, currentPassword, newPassword }),
          });
          if (res.ok) {
            settingsFormSuccess.textContent = "Settings updated successfully!";
            setTimeout(() => {
              settingsFormSuccess.textContent = "";
            }, 2000);
          } else {
            const data = await res.json();
            settingsFormSuccess.textContent =
              data.message || "Failed to update settings.";
          }
        } catch (err) {
          settingsFormSuccess.textContent = "Error updating settings.";
        }
      });
    </script>
  </body>
</html>
